<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UPGMA the hard way • compbio4all</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="UPGMA the hard way">
<meta property="og:description" content="compbio4all">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">compbio4all</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Higgs_Atwood_AA_analysis-from-unit4-test-ORIG-with-misc-updates-studnet-vs.html">Higgs and Atwood student version with updates</a>
    </li>
    <li>
      <a href="../articles/Higgs_Atwood_AA_analysis-from-unit4-test-ORIG-with-misc-updates.html">Higgs and Atwood student version with updates - copy or alt?</a>
    </li>
    <li>
      <a href="../articles/Higgs_Atwood_AA_analysis-from-unit4-test-ORIG.html">Higgs and Atwood student version with updates - orig?</a>
    </li>
    <li>
      <a href="../articles/Higgs_aa_data_1_ggpubr.html">Software Checkpoint: ggpubr using Higgs and Atwood amino acids</a>
    </li>
    <li>
      <a href="../articles/Higgs_aa_data_1_load_and_replicate_plot.html">Higgs and Atwood part 1</a>
    </li>
    <li>
      <a href="../articles/PCA_tutorial_iris_data-inc_PCA_by_hand.html">Another PCA tutorial with Fisher's Iris Data</a>
    </li>
    <li>
      <a href="../articles/PCA_with_vegans_DCA.html">vegan PCA: Principal Components Analysis with vegans rda function</a>
    </li>
    <li>
      <a href="../articles/aaa-project_notes.html">a) Project notes</a>
    </li>
    <li>
      <a href="../articles/ac-a-introduction.html">a) Introduction</a>
    </li>
    <li>
      <a href="../articles/ac-k-GC_content_local_variation.html">k) Local variation in GC content</a>
    </li>
    <li>
      <a href="../articles/ac-u-HMM_sequence_evolution.html">u) Hidden Markov Models</a>
    </li>
    <li>
      <a href="../articles/aminio-acids-worked_example_data_visualization-DeprecatedQ.html">Worked example: Data visualization in R</a>
    </li>
    <li>
      <a href="../articles/basic_ac-h-vectors-AC04-01.html">Mini tutorial: Vectors in R</a>
    </li>
    <li>
      <a href="../articles/bbb-motivating_example.html">b) Motivating examples: Species distribution models</a>
    </li>
    <li>
      <a href="../articles/bbb-quickstart_RStudio_cloud.html">Quick start - RStudio Cloud</a>
    </li>
    <li>
      <a href="../articles/casestudy-1st_encounter_w_data_a_summary_stats-FROGARMS.html">Frog-armed: A first encounter with data</a>
    </li>
    <li>
      <a href="../articles/casestudy-1st_encounter_w_data_b_graphs-FROGARMS.html">A first encounter with data: graphs</a>
    </li>
    <li>
      <a href="../articles/casestudy-1st_encounter_w_data_c_t_test-FROGARMS.html">First encounter with data - t-test deprecated?</a>
    </li>
    <li>
      <a href="../articles/ccc-ac-b-downloading_R_AC01-1.html">b) Downloading R</a>
    </li>
    <li>
      <a href="../articles/ccc-ac-c-installing_RStudio_AC01-2.html">c) Downloading the RStudio IDE</a>
    </li>
    <li>
      <a href="../articles/ccc-ac-d-installing_packages_in_RStudio_AC01-3.html">d) Installing R packages</a>
    </li>
    <li>
      <a href="../articles/ccc-ac-e-installing_bioconductor_AC01-4.html">e) Installing Bioconductor</a>
    </li>
    <li>
      <a href="../articles/ccc-ac-f-brief_intro_to_R_AC01-5.html">f) A Brief introduction to R</a>
    </li>
    <li>
      <a href="../articles/data_cleaning-dplyr_filter.html">Data Cleaning: Filtering focal rows with dplyr</a>
    </li>
    <li>
      <a href="../articles/data_cleaning-merge_BBS_with_landcover.html">Data cleaning: Merging 2 large data sets with dplyr</a>
    </li>
    <li>
      <a href="../articles/data_cleaning_selecting_different_spp_and_landcovers.html">Selecting different species and landovers from the wildlifeR package</a>
    </li>
    <li>
      <a href="../articles/ddd-ac-g-NCBI_by_GUI1_AC03-1.html">g) Downloading NCBI sequence data by hand</a>
    </li>
    <li>
      <a href="../articles/ddd-ac-h-DNA_sequence_descriptive_stats-AC03-02-.html">DNA descriptive statics - Part 1</a>
    </li>
    <li>
      <a href="../articles/ddd-ac-h-NCBI_by_GUI2_AC03-1Q.html">h) Introduction to biological sequences databases</a>
    </li>
    <li>
      <a href="../articles/ddd-ac-h-downloading_DNA_seq_in_R-AC03-01.html">Downloading DNA sequences with R</a>
    </li>
    <li>
      <a href="../articles/ddd-ac-i-uniprot_by_GUI-AC07-01.html">i) Downloading sequences from UniProt by hand</a>
    </li>
    <li>
      <a href="../articles/ddd-ac-j-advanced_NCBI_AC05-01.html">j) Sequence Databases</a>
    </li>
    <li>
      <a href="../articles/eee-PAM_matrices.html">The Dayhoff PAM matrices</a>
    </li>
    <li>
      <a href="../articles/eee-ac-l-alignment_in_R-AC07-02.html">l) Aligments in R</a>
    </li>
    <li>
      <a href="../articles/eee-ac-o-test_alignment_sig_pvalue-AC07-03-NOT_UPATED.html">o) Testing the significance of an alignment</a>
    </li>
    <li>
      <a href="../articles/eee-alignment.html">Aligments and matrices</a>
    </li>
    <li>
      <a href="../articles/eee-nlb-alignment-walkthrough.html">NB-a) Hello R!  Bioinformatics awesomness in a flash</a>
    </li>
    <li>
      <a href="../articles/fff-blast-Pevsner_Ch4_figure4_12.html">Pevsner Chapter 3: BLAST Algorithm in R (kinda)</a>
    </li>
    <li>
      <a href="../articles/fff-blast-Pevsner_Ch4_figure4_14.html">Pevsner Figure 4.14</a>
    </li>
    <li>
      <a href="../articles/fff-blast-Pevsner_Ch4_figure4_14_extension.html">Simulating sequences to get an EVD</a>
    </li>
    <li>
      <a href="../articles/fff-blast_via_R.html">BLAST via R</a>
    </li>
    <li>
      <a href="../articles/fff-nlb-BLAST_summary.html">BLAST Summary</a>
    </li>
    <li>
      <a href="../articles/ggg-ac-m1-retrieving_mult_seqs-AC08-01-NOTUPATED.html">p) Retrieving multiple sequences in R</a>
    </li>
    <li>
      <a href="../articles/ggg-ac-m2-mult_align_CLUSTAL-AC08-02-NEEDS_MAJOR_REWRITE.html">m) Multiple alignment with Clustal</a>
    </li>
    <li>
      <a href="../articles/jjj-ac-q-comp_gene_find-AC10-01-NOTUPATED.html">q) Computational gene finding</a>
    </li>
    <li>
      <a href="../articles/jjj-ac-r-sig_of_ORFs-AC10-02-NOTUPATED.html">r) Significance of ORFs</a>
    </li>
    <li>
      <a href="../articles/lll-UPGMA-WPGMA_wikipedia.html">WPGMA or UPGMA?</a>
    </li>
    <li>
      <a href="../articles/lll-UPGMA_algo_fnxns-not_finished.html">UPGMA functions</a>
    </li>
    <li>
      <a href="../articles/lll-UPGMA_by_hand-updated.html">UPGMA the hard way</a>
    </li>
    <li>
      <a href="../articles/lll-UPGMA_cluster_maximization_used_in_effron.html">UPGMA - Cluster max</a>
    </li>
    <li>
      <a href="../articles/lll-UPGMA_in_R.html">UPGMA in R</a>
    </li>
    <li>
      <a href="../articles/lll-UPGMA_wikipedia_homework-ALT-Q.html">UPGMA Wikipedia example - copy or alt Q</a>
    </li>
    <li>
      <a href="../articles/lll-UPGMA_wikipedia_homework.html">UPGMA in R - the hard way - deprecated?</a>
    </li>
    <li>
      <a href="../articles/lll-ac-m3-rooted_tree_NJ-AC08-04-NOTUPATED.html">s) Rooted Neighbor-joining Phylogenetic trees</a>
    </li>
    <li>
      <a href="../articles/lll-ac-m4-unrooted_tree_NJ_tree-AC08-03-NEEDS_MAJOR_REWRITE.html">n) Unrooted Neighbor-joining Phylogenetic trees</a>
    </li>
    <li>
      <a href="../articles/lll-jc_distance_fnxn.html">Jukes-Cantor Distance Function</a>
    </li>
    <li>
      <a href="../articles/lll-jc_sim_for_render.html">Simulating molecular evolution</a>
    </li>
    <li>
      <a href="../articles/lll-phylo-newick_format.html">Newick format in R</a>
    </li>
    <li>
      <a href="../articles/lll-phylo-number_of_phylogenetic_trees.html">Tutorial: Writing functions to calculate the number of phylogenetic trees</a>
    </li>
    <li>
      <a href="../articles/lll-phylo-number_of_phylogenetic_trees_KEY.html">Tutorial: Writing functions to calculate the number of phylogenetic trees - KEY</a>
    </li>
    <li>
      <a href="../articles/llll-phylo_from_sequence_to_phylo_tree.html">Worked example: from sequence to phylogenetic tree</a>
    </li>
    <li>
      <a href="../articles/multivar_INTRO-high_dimensional_data_in_biology-iris_BCI_etc.html">Multivariate Data Analysis: Making Sense of High-Dimensional Data</a>
    </li>
    <li>
      <a href="../articles/multivar_data-allometry_0_allometric_scaling.html">Software checkpoint: ggplot2 and ggpubr</a>
    </li>
    <li>
      <a href="../articles/multivar_data-allometry_1_scp_ggpubr-KEY.html">Software checkpoint: ggplot2 and ggpubr-KEY</a>
    </li>
    <li>
      <a href="../articles/multivar_data-allometry_1_scp_ggpubr.html">ggplot2 and ggpubr software checkpoint</a>
    </li>
    <li>
      <a href="../articles/multivar_data-allometry_2_allometric_data_ccp-KEY.html">Coding checkpoint: Plotting allometric data with ggpubr-KEY</a>
    </li>
    <li>
      <a href="../articles/multivar_data-allometry_2_allometric_data_ccp.html">Coding checkpoint: Plotting allometric data with ggpubr</a>
    </li>
    <li>
      <a href="../articles/multivar_data-allometry_4_vegan_and_pca.html">Overview: The vegan package for PCA</a>
    </li>
    <li>
      <a href="../articles/multivar_data-allometry_5_cluster.html">Checkpoint: Cluster analysis with allometric data</a>
    </li>
    <li>
      <a href="../articles/multivar_data-allomtery_3_scp_scatterplot3d.html">Software checkpoint: scatterplot 3D</a>
    </li>
    <li>
      <a href="../articles/multivar_distances-GC_conent.html">Hiearchical clustering with Euclidean distances</a>
    </li>
    <li>
      <a href="../articles/nnn-ac-t-comparative_genomics.html">t) Comparative Genomics</a>
    </li>
    <li>
      <a href="../articles/plot-displaying_data_box_hist_base_R-NEEDS-IMAGES.html">Displaying Data - boxplot() &amp; hist()</a>
    </li>
    <li>
      <a href="../articles/plot-par_tutorial.html">Graphical parameters in R with par(): With great power comes great responsibility</a>
    </li>
    <li>
      <a href="../articles/plot_nlb-scp-ggplot2-ggpubr-allometric_scaling.html">Software checkpoint: ggplot2 and ggpubr-COPY?</a>
    </li>
    <li>
      <a href="../articles/prog-R_quirks_putting_things_into_vectors.html">R quirks: putting things in vectors</a>
    </li>
    <li>
      <a href="../articles/prog-assignment-for_loops.html">for loops in R</a>
    </li>
    <li>
      <a href="../articles/prog-simulate_random_aa_seqs.html">Simulating random amino acid sequences</a>
    </li>
    <li>
      <a href="../articles/prog_ac-h-programming_in_R-AC04-02.html">Programming in R: for loops and functions</a>
    </li>
    <li>
      <a href="../articles/prog_assignment-function_practice.html">Writing functions - practice problems</a>
    </li>
    <li>
      <a href="../articles/prog_assignment-regex-accessions.html">Computational Biology Portfolio: Practice Working with Strings</a>
    </li>
    <li>
      <a href="../articles/prog_data_frame_by_hand.html">Building dataframes by hand</a>
    </li>
    <li>
      <a href="../articles/prog_data_frame_by_hand_problem_set-KEY.html">Dataframe by hand - problem set - KEY</a>
    </li>
    <li>
      <a href="../articles/prog_data_frame_by_hand_problem_set.html">Dataframe by hand - problem set</a>
    </li>
    <li>
      <a href="../articles/prog_dataframe_by_hand_simple_with_plots.html">Making a simple dataframe</a>
    </li>
    <li>
      <a href="../articles/prog_nlb-walkthrough-making_simple_df.html">Walkthrough - making a simple dataframe</a>
    </li>
    <li>
      <a href="../articles/sss-nlb-types_of_data.html">Types of data</a>
    </li>
    <li>
      <a href="../articles/sss-stats-ANOVA_deer_antlers-ADD-DATA.html">Intro to 1-way ANOVA: impacts of diet on deer antlers</a>
    </li>
    <li>
      <a href="../articles/sss-stats-Inf_by_eye.html">Inference-by-eye using RA Fisher's Cat Data</a>
    </li>
    <li>
      <a href="../articles/sss-stats-_means_errorbars_2016_base_R.html">Displaying data - means &amp; error bars</a>
    </li>
    <li>
      <a href="../articles/sss-stats-p_values_defined.html">P-values</a>
    </li>
    <li>
      <a href="../articles/sss-stats-paired_t_test_2_ways_walkthrough.html">paried t tests</a>
    </li>
    <li>
      <a href="../articles/sss-stats-tttest-reporting_paired_t_test.html">Running &amp; reporting paired t-tests in R</a>
    </li>
    <li>
      <a href="../articles/sss-stats-tttest-reporting_t_test-ADD-DATA.html">Reporting statistical result from a 2-sample t-test</a>
    </li>
    <li>
      <a href="../articles/zzz0-undergrad_editors.html">z0) Undergraduate editors</a>
    </li>
    <li>
      <a href="../articles/zzz0-vocab.html">z) vocab</a>
    </li>
    <li>
      <a href="../articles/zzz1-temp.html">z) vignette template</a>
    </li>
    <li>
      <a href="../articles/zzz2-TODO.html">TODO</a>
    </li>
    <li>
      <a href="../articles/zzz3-creating_this_package.html">x) Creating this package</a>
    </li>
    <li>
      <a href="../articles/zzz4-document_datasets.html">y) Documenting datasets</a>
    </li>
    <li>
      <a href="../articles/zzz5-build_and_rebuild_package.html">Building &amp; rebuilding this package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="lll-UPGMA_by_hand-updated_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>UPGMA the hard way</h1>
            
      
      
      <div class="hidden name"><code>lll-UPGMA_by_hand-updated.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">compbio4all</span><span class="op">)</span></code></pre></div>
<div id="introudction-to-upgma" class="section level2">
<h2 class="hasAnchor">
<a href="#introudction-to-upgma" class="anchor"></a>Introudction to UPGMA</h2>
<ul>
<li>UPGMA is a basic <strong>clustering algorithm</strong> which can be used for building phylognetic tree from <strong>distance matrices</strong>.<br>
</li>
<li>It still has some applications because it is fast, but it has mostly beenn replaced by Neighbor Joining and Minimum Evolution methods.</li>
<li>UPGMA is still useful for teaching the basic steps involved in data clustering and building trees.</li>
<li>UPGMA is a particular variant of a general class of algorithms. Another varient is WPGMA.</li>
</ul>
</div>
<div id="preliminaries" class="section level2">
<h2 class="hasAnchor">
<a href="#preliminaries" class="anchor"></a>Preliminaries</h2>
<div id="r-libraries" class="section level3">
<h3 class="hasAnchor">
<a href="#r-libraries" class="anchor"></a>R Libraries</h3>
<p>The phangorn package contains the functions</p>
<ul>
<li>upgma()</li>
<li>wpgma()</li>
</ul>
<p>The ape package has the function nj() for neighbor joinging, which is useful for comparison to UPGMA.</p>
<div id="phylogenetic-libraries" class="section level4">
<h4 class="hasAnchor">
<a href="#phylogenetic-libraries" class="anchor"></a>Phylogenetic libraries</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#install.packages("ape")</span>
<span class="co">#install.packages("phangorn")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/">ape</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/KlausVigo/phangorn">phangorn</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="plotting-libraries" class="section level4">
<h4 class="hasAnchor">
<a href="#plotting-libraries" class="anchor"></a>Plotting libraries</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#install.packages("plotrix")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">plotrix</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="custom-function-well-use" class="section level3">
<h3 class="hasAnchor">
<a href="#custom-function-well-use" class="anchor"></a>Custom function we’ll use</h3>
<p>To help us understand clustering and UPGMA I’ve written a cusome function.</p>
<p>This function, plot_dist_as_nmds(), will make a 2-dimensional (2D) representation of the distance matrices we’ll be working with. This is only an approximation and will occassionally result in distorions.</p>
<p>What this function does is take a <strong>distance matix</strong> and attempt to plot the data as if they were in 2-dimensional space. If we were giving it the distance between building on campus it would plot a reasonable map. Since we’ll be plotting data that isn’t physical distance but genetic distances this will not be a real evolutionary tree. The intent here is to help you build your intuition about what a distane matrix is.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Load ALL of this code</span>

<span class="co"># TODO: ylim and xlim are current hard coded</span>

<span class="va">plot_dist_as_nmds</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mat</span>, <span class="va">x.lim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>,<span class="fl">20</span><span class="op">)</span>, <span class="va">y.lim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">matno0</span> <span class="op">&lt;-</span> <span class="va">mat</span>
  
<span class="va">matno0</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">matno0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>


<span class="va">d2</span>  <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cmdscale.html">cmdscale</a></span><span class="op">(</span><span class="va">matno0</span>, add <span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">d2</span><span class="op">$</span><span class="va">points</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">d2</span><span class="op">$</span><span class="va">points</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>, main <span class="op">=</span> <span class="st">"APPROXIMATE 2D distances"</span>,
     xlim <span class="op">=</span> <span class="va">x.lim</span>, 
     ylim <span class="op">=</span> <span class="va">y.lim</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">d2</span><span class="op">$</span><span class="va">points</span><span class="op">)</span>, cex<span class="op">=</span><span class="fl">3</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">d2</span><span class="op">)</span>

<span class="op">}</span></code></pre></div>
</div>
</div>
<div id="data-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#data-matrix" class="anchor"></a>Data matrix</h2>
<p>We’ll use data from a study that built a tree using rRNA from bacteria.</p>
<p>The data and a worked example are available at <a href="https://en.wikipedia.org/wiki/UPGMA#First_step" class="uri">https://en.wikipedia.org/wiki/UPGMA#First_step</a></p>
<p>This particular matrix is set up as the number of bases that are different between each sequence. (In the next unit we’ll discuss how they didn’t use just a simple count of the differences).</p>
<div id="building-the-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#building-the-matrix" class="anchor"></a>Building the matrix</h3>
<p>One way to make the data is to use the rbind() individual vectors as rows</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The data</span>
<span class="co">#      a   b   c   d   e</span>
<span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,    <span class="fl">17</span>, <span class="fl">21</span>, <span class="fl">31</span>, <span class="fl">23</span><span class="op">)</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">0</span>,    <span class="fl">30</span>, <span class="fl">34</span>, <span class="fl">21</span><span class="op">)</span>
<span class="va">c</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">21</span>, <span class="fl">30</span>, <span class="fl">0</span>,  <span class="fl">28</span>, <span class="fl">39</span><span class="op">)</span>
<span class="va">d</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">31</span>, <span class="fl">34</span>, <span class="fl">28</span>,    <span class="fl">0</span>, <span class="fl">43</span><span class="op">)</span>
<span class="va">e</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">23</span>, <span class="fl">21</span>, <span class="fl">39</span>, <span class="fl">43</span>,    <span class="fl">0</span><span class="op">)</span>

<span class="co"># Bind into a matrix</span>
<span class="va">dmat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span>,<span class="va">c</span>,<span class="va">d</span>,<span class="va">e</span><span class="op">)</span></code></pre></div>
<p>rbind() takes each vector (a through e) and glues them together into a matrix</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">is</span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span>
<span class="co">#&gt; [1] "matrix"    "array"     "mMatrix"   "structure" "vector"</span></code></pre></div>
<p>As a challenge, can you take these data and make these data into a matrix using the matrix() function?</p>
<p>The finished matrix looks like this</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dmat1</span>
<span class="co">#&gt;   [,1] [,2] [,3] [,4] [,5]</span>
<span class="co">#&gt; a    0   17   21   31   23</span>
<span class="co">#&gt; b   17    0   30   34   21</span>
<span class="co">#&gt; c   21   30    0   28   39</span>
<span class="co">#&gt; d   31   34   28    0   43</span>
<span class="co">#&gt; e   23   21   39   43    0</span></code></pre></div>
<p>Add names using colnames()</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span>,<span class="st">"d"</span>,<span class="st">"e"</span><span class="op">)</span></code></pre></div>
<p>The matrix is <strong>symmetrical</strong>.</p>
<p><strong>Challenge questions:</strong> How would we interpret the diagonal? Why is it not 1? Why is this matrix symmetrical?</p>
<p>Its easier if you make redundant elements NA because we don’t need them.</p>
<p>We can access the <strong>diagonal</strong> of the matrix directly and set it to NA using the diag() function</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NA</span></code></pre></div>
<p>Now the matrix looks like this</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dmat1</span>
<span class="co">#&gt;    a  b  c  d  e</span>
<span class="co">#&gt; a NA 17 21 31 23</span>
<span class="co">#&gt; b 17 NA 30 34 21</span>
<span class="co">#&gt; c 21 30 NA 28 39</span>
<span class="co">#&gt; d 31 34 28 NA 43</span>
<span class="co">#&gt; e 23 21 39 43 NA</span></code></pre></div>
<p>We only need the lower left-hand part of the matrix. We can set the upper right-hand part of the matrix to NA like this:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dmat1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">upper.tri</a></span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></code></pre></div>
<p>(don’t worry about exactly what’s going on here)</p>
<p>Matrix now looks like this</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dmat1</span>
<span class="co">#&gt;    a  b  c  d  e</span>
<span class="co">#&gt; a NA NA NA NA NA</span>
<span class="co">#&gt; b 17 NA NA NA NA</span>
<span class="co">#&gt; c 21 30 NA NA NA</span>
<span class="co">#&gt; d 31 34 28 NA NA</span>
<span class="co">#&gt; e 23 21 39 43 NA</span></code></pre></div>
</div>
</div>
<div id="what-does-this-distance-matrix-represent" class="section level2">
<h2 class="hasAnchor">
<a href="#what-does-this-distance-matrix-represent" class="anchor"></a>What does this distance matrix represent?</h2>
<div id="genetic-distances-conceptualized-as-pairwise-linear-distances" class="section level3">
<h3 class="hasAnchor">
<a href="#genetic-distances-conceptualized-as-pairwise-linear-distances" class="anchor"></a>Genetic distances conceptualized as pairwise linear distances</h3>
<ul>
<li>Each element of the matrix is a <strong>pairwise distance.</strong><br>
</li>
<li>These distances were computed using <strong>pairwise alignments</strong> of each sequence.</li>
<li>In this case, it is the number of nucleotides that are different between two sequences.</li>
<li>As is standard, these alginments ignored any <strong>indels.</strong>
</li>
<li>There are 5 sequences, and if each is compared against the other then there are 10 total <strong>distances.</strong><br>
</li>
<li>Mathematically these are called <strong>Hamming distances</strong>.</li>
</ul>
<p>Each distance is the distance between two species, and it can be conceptualized on its own as a linear distance.</p>
<p>You could visualize a single <strong>pairwise distance</strong> like a linear distance like this:</p>
<p>(note: you don’t need to understand all of this code, but you do need to understand how it relates to the distance amtrix)</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">dmat1</span>,na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>, 
     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">12</span><span class="op">)</span>, 
     type <span class="op">=</span> <span class="st">"l"</span>,
     xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Distance (number of mutations)"</span><span class="op">)</span>,
     ylab <span class="op">=</span> <span class="st">"Pairwise comparison"</span>,
     main <span class="op">=</span> <span class="st">"Linear distance a vs. b"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, pch <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">dmat1</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fl">1</span>, pch <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">0</span>, y0 <span class="op">=</span> <span class="fl">1</span>, 
         x1 <span class="op">=</span> <span class="va">dmat1</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>,y1 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">1.5</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>We can look at all of the distance Note that each line is <em>independent</em> and cannot be compared (the y axis has no meaning). This is NOT a 2D map!</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This code is complex and the goal is to assess the plot, not understand the code</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">dmat1</span>,na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>, 
     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">12</span><span class="op">)</span>, 
     type <span class="op">=</span> <span class="st">"l"</span>,
     xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Distance (number of mutations)"</span><span class="op">)</span>,
     ylab <span class="op">=</span> <span class="st">"Pairwise comparison"</span><span class="op">)</span>
<span class="va">pair.k</span> <span class="op">&lt;-</span><span class="fl">0</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>

<span class="va">dist.ij</span> <span class="op">&lt;-</span> <span class="va">dmat1</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> 
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dist.ij</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>
  <span class="va">pair.k</span> <span class="op">&lt;-</span> <span class="va">pair.k</span><span class="op">+</span><span class="fl">1</span>    

       
<span class="va">spp.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
<span class="va">spp.j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,               <span class="va">pair.k</span>, pch <span class="op">=</span> <span class="va">spp.j</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">LETTERS</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">toupper</a></span><span class="op">(</span><span class="va">spp.j</span><span class="op">)</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">1.75</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">dist.ij</span><span class="op">+</span><span class="fl">0.75</span>,       <span class="va">pair.k</span>, pch <span class="op">=</span><span class="va">spp.i</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">LETTERS</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">toupper</a></span><span class="op">(</span><span class="va">spp.i</span><span class="op">)</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">1.75</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">0</span>, y0 <span class="op">=</span> <span class="va">pair.k</span>, 
         x1 <span class="op">=</span> <span class="va">dist.ij</span>, y1 <span class="op">=</span> <span class="va">pair.k</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">pair.k</span><span class="op">+</span><span class="fl">0.5</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="op">}</span>

  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<ul>
<li>We can see that the distance between a and b is the smallest, at 17 amino acid changes.</li>
<li>UPGMA, WPGMA and related algorithms all begin by identifying the two taxa that are closest together.</li>
<li>These 2 taxa form a clade (cluster). THe algorithm then proceeds by finding the next taxa (eg, c, d or e) which is closest to that clade of a and b</li>
<li>We can summarize this first clad using <strong>Newick notation</strong> as: (a, b)</li>
</ul>
</div>
<div id="genetic-distances-conceptualized-as-2d-map-of-linear-distances" class="section level3">
<h3 class="hasAnchor">
<a href="#genetic-distances-conceptualized-as-2d-map-of-linear-distances" class="anchor"></a>Genetic distances conceptualized as 2D map of linear distances</h3>
<ul>
<li>We can extend the analogy of linear distance to two dimensions.<br>
</li>
<li>With some fancy math we can make a 2D plot where the distances in 2D space are <em>similar</em> to the distances in the matrix.<br>
</li>
<li>This is NOT exact and should not be taken literally. (See Pevsner Chapter 7 for a similar use of a 2D map)</li>
<li>This is just a tool for teaching and not something done as part of an actual analysis.</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">dmat1no0</span> <span class="op">&lt;-</span> <span class="va">dmat1</span>
  
<span class="va">dmat1no0</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dmat1no0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>

<span class="va">d2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cmdscale.html">cmdscale</a></span><span class="op">(</span><span class="va">dmat1no0</span>, add <span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">d2</span><span class="op">$</span><span class="va">points</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">d2</span><span class="op">$</span><span class="va">points</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>, main <span class="op">=</span> <span class="st">"APPROXIMATE 2D distances"</span>,xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>,<span class="fl">20</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">d2</span><span class="op">$</span><span class="va">points</span><span class="op">)</span>, cex<span class="op">=</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<ul>
<li>In this plot, things appear to have been distorted a bit.</li>
<li>a and b are close to each other as expect,</li>
<li>but b looks closest than e (to me).<br>
</li>
<li>It does show how a and b are close, and d and e are further apart.</li>
</ul>
</div>
</div>
<div id="from-linear-distances-to-tree-distances" class="section level2">
<h2 class="hasAnchor">
<a href="#from-linear-distances-to-tree-distances" class="anchor"></a>From linear distances to “tree distances”</h2>
<p><strong>Genetic distances</strong> aren’t actually linear - we are assuming a “tree shape” to represent the divergence of two species genetically (and possibly geographically).</p>
<p>The simplest methods of building trees assume that all branch lengths terminate at the same distance from the root, and the total mutational distance traversed by each species is the same. (This is the assumption or constraint related to <strong>ultrametricity</strong>).</p>
<p>The distance between a and b is 17. We assume that both species a and species b have undergone the same number of mutations since they split, so the branch lengths for each are 17/2 = 8.5. (You obviously can’t have 8.5 mutations, but this is how the math works).</p>
<p>The following plots shows how the linear distnace of 17 between a and b (bottom) gets split into two branches, each of 8.5.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This code is dense; run it and focus on the plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">dmat1</span>,na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>, 
     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">12</span><span class="op">)</span>, 
     type <span class="op">=</span> <span class="st">"l"</span>,
     xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Distance (number of mutations)"</span><span class="op">)</span>,
     ylab <span class="op">=</span> <span class="st">"Pairwise comparison"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, pch <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">dmat1</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fl">1</span>, pch <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">0</span>, y0 <span class="op">=</span> <span class="fl">1</span>, 
         x1 <span class="op">=</span> <span class="va">dmat1</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>,y1 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">1.5</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>


<span class="va">branch.length</span> <span class="op">&lt;-</span> <span class="va">dmat1</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fl">2</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">branch.length</span><span class="op">+</span><span class="fl">0.75</span>, <span class="fl">4</span>, pch <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">branch.length</span><span class="op">+</span><span class="fl">0.75</span>, <span class="fl">6</span>, pch <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">0</span>, y0 <span class="op">=</span> <span class="fl">4</span>, 
         x1 <span class="op">=</span> <span class="va">branch.length</span>,y1 <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">0</span>, y0 <span class="op">=</span> <span class="fl">6</span>, 
         x1 <span class="op">=</span> <span class="va">branch.length</span>,y1 <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">0</span>, y0 <span class="op">=</span> <span class="fl">4</span>, 
         x1 <span class="op">=</span> <span class="fl">0</span>, y1 <span class="op">=</span> <span class="fl">6</span>, col <span class="op">=</span> <span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">8</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>Again, in <strong>Newick notation</strong>, we’d write (a, b) to indicate that a and b are a clade.</p>
</div>
<div id="the-upgma-algorithm" class="section level2">
<h2 class="hasAnchor">
<a href="#the-upgma-algorithm" class="anchor"></a>The UPGMA algorithm</h2>
<p><em>The UPGMA algorithm is described by Swofford et al (1996?, page 486) as below.<br></em> The word “cluster” means “taxa” in some cases and “clade” in others.<br>
* This is a bit tricky at first but once you get a sense for the whole algorithm it will make more sense. * To keep track of everything we’ll use subscripts i and j, represented in plain text as e.g. d.ij for the distance (d) in row i and column j.</p>
<div id="step-1-find-the-2-taxa-that-are-currently-closest-together" class="section level3">
<h3 class="hasAnchor">
<a href="#step-1-find-the-2-taxa-that-are-currently-closest-together" class="anchor"></a>Step 1: find the 2 taxa that are currently closest together</h3>
<ol style="list-style-type: decimal">
<li>“Given a matrix of <strong>pairwise distances</strong>, find the clusters (taxa) i and j such the d.ij is the minmum value in the table.” (d.ij is the distance between taxa i and taxa j)</li>
</ol>
<p>In our example, d.ij = d.ba = 17, with i = b and j = a.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dmat1</span><span class="op">[</span><span class="st">"b"</span>,<span class="st">"a"</span><span class="op">]</span>
<span class="co">#&gt; [1] 17</span></code></pre></div>
</div>
<div id="step-2-calculate-the-branch-lengths-connect-the-taxa-to-their-shared-node" class="section level3">
<h3 class="hasAnchor">
<a href="#step-2-calculate-the-branch-lengths-connect-the-taxa-to-their-shared-node" class="anchor"></a>Step 2: calculate the branch lengths connect the taxa to their shared node</h3>
<ol start="2" style="list-style-type: decimal">
<li>“Define the depth of the branching between i and j (l.ij) to be d.ij/2” (“depth of branching” = <strong>branch length</strong>; so i is attached to a branch of d.ij/2 and j is attached to a separate branch of d.ij/2)</li>
</ol>
<p>d.ab/2 = 8.5</p>
</div>
<div id="step-3a-determine-if-the-algorithm-is-done" class="section level3">
<h3 class="hasAnchor">
<a href="#step-3a-determine-if-the-algorithm-is-done" class="anchor"></a>Step 3a: determine if the algorithm is done</h3>
<ol start="3" style="list-style-type: decimal">
<li>“If i and j were the last two clusters, the tree is complete”</li>
</ol>
</div>
<div id="step-3a-continue-on-if-needed-and-combine-the-previous-cluster-into-cluster-u" class="section level3">
<h3 class="hasAnchor">
<a href="#step-3a-continue-on-if-needed-and-combine-the-previous-cluster-into-cluster-u" class="anchor"></a>Step 3a: Continue on if needed and combine the previous cluster into cluster “u”</h3>
<ol start="3" style="list-style-type: decimal">
<li>If there is more to do, “create a new cluster called u”. This new cluster is a clade of a and b will represent the combined features of a and b.</li>
</ol>
<p>What this means is that now that we’ve mapped taxa a and b into a clade we need to update our matrix to determine how far all the remaining taca (c, d and e) are from that clade.</p>
</div>
<div id="step-4-determine-the-distance-from-u-to-the-other-remaining-clusters-" class="section level3">
<h3 class="hasAnchor">
<a href="#step-4-determine-the-distance-from-u-to-the-other-remaining-clusters-" class="anchor"></a>Step 4: Determine the distance from u to the other remaining clusters.</h3>
<ol start="4" style="list-style-type: decimal">
<li>“Define the distance from [the new cluster] u to each other [remaining] cluster (k, with k==i or j) [here cluster = clade in the first part of the sentence and taxa in the other] to be an <strong>average</strong> of the distnace d.ki and d.jk”. That is, calculate the distance from the new clade u to all the remaining taxa, which we’ll generically call “k”. The new distance will be called d.ku, for “distance from taxa k to clade u.”</li>
</ol>
<p>The exact calculation of the average can take different forms. This will be unpacked below.</p>
</div>
<div id="step-5-create-a-new-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#step-5-create-a-new-matrix" class="anchor"></a>Step 5: Create a new matrix</h3>
<ol start="5" style="list-style-type: decimal">
<li>“Go back to step 1 with one less cluster; cluster i and j have been eliminated, and cluster u has been added.” The distance matrix is now shrunk with all distance related to i and j removed and replaced by information about u.</li>
</ol>
</div>
<div id="key-step-calculating-the-distance-from-a-clade-to-the-remaining-taxa" class="section level3">
<h3 class="hasAnchor">
<a href="#key-step-calculating-the-distance-from-a-clade-to-the-remaining-taxa" class="anchor"></a>Key step: calculating the distance from a clade to the remaining taxa</h3>
<p>For step 4, UPGMA uses the equation below to calculate distances. This will require some notation:</p>
<ul>
<li>Ti = the number of taxa in cluster i. This is 1 if the “cluster” is a single taxa (eg. 1 species), or it can be &gt;1 if a previous iteration has created a clade.<br>
</li>
<li>Tj = the number of taxa in cluster j.</li>
<li>d.ku = the distance from k to u. k and u can be individual taxa OR clades created by the algorithm.</li>
</ul>
<p>The key quantity d.ku is calculated as:</p>
<p>d.ku = (Ti x d.ki + Tj x d.kj)/(Ti + Tj)</p>
<p>(You should know this equation AND you should be able to write R code to calcualte it)</p>
<p>You can think of this as a <strong>weighted mean</strong> where the <strong>weights</strong> are the number of taxa in each clade. Its a very annoying that the “U” in UPGMA means “un-weighted” even though there is, from one perspective weighting, but this is how the math people say we should think about it (the un-weighted part has to do with some other aspect of the math).</p>
<p>In the above outline of the algorithm, if i and j are the first two taxa grouped then the equation would be</p>
<p>d.ku = (Ti x d.ki + Tj x d.kj)/(Ti + Tj) Ti = 1, Tj = 1, so d.ku = (1 x d.ki + 1 x d.kj)/(1 + 1) d.ku = (d.ki + d.kj)/2</p>
</div>
</div>
<div id="calculate-2d-representation" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-2d-representation" class="anchor"></a>Calculate 2D representation</h2>
<p>We can think about this using a 2D representation.</p>
<p>First, plot the 2D map.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dmat1.out</span><span class="op">&lt;-</span> <span class="fu">plot_dist_as_nmds</span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>a and b are closest together, so we group them</p>
<p>I’ll show this in the code below; you don’t need to understand exactly how this code works.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dmat1.out</span><span class="op">&lt;-</span> <span class="fu">plot_dist_as_nmds</span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span>

<span class="co">#get x y coord of a and b</span>

<span class="va">a.</span><span class="op">&lt;-</span><span class="va">dmat1.out</span><span class="op">$</span><span class="va">points</span><span class="op">[</span><span class="st">"a"</span>,<span class="op">]</span>
<span class="va">b.</span><span class="op">&lt;-</span><span class="va">dmat1.out</span><span class="op">$</span><span class="va">points</span><span class="op">[</span><span class="st">"b"</span>,<span class="op">]</span>

<span class="fu">plot_dist_as_nmds</span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span>
<span class="co">#&gt; $points</span>
<span class="co">#&gt;         [,1]       [,2]</span>
<span class="co">#&gt; a   6.606653  4.9400937</span>
<span class="co">#&gt; b  12.421702 -6.5267890</span>
<span class="co">#&gt; c  -9.532025 12.9665271</span>
<span class="co">#&gt; d -17.839642 -9.0739515</span>
<span class="co">#&gt; e  20.738283  0.4897976</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $eig</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $x</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ac</span>
<span class="co">#&gt; [1] -7.934712e-15</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $GOF</span>
<span class="co">#&gt; [1] 0.6755273 0.9367305</span>
<span class="fu"><a href="https://rdrr.io/pkg/plotrix/man/draw.ellipse.html">draw.ellipse</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">a.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">b.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, 
             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">a.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="va">b.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,
             a <span class="op">=</span><span class="fl">3</span>, 
             b <span class="op">=</span> <span class="fl">10</span>, 
             angle <span class="op">=</span> <span class="fl">30</span>
             <span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>Once we have created a cluster (clade) we can consider the distance from the members of clade to all the remaining points. For example, here’s the distnace from a and b to c</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># distance from ab to c</span>
<span class="va">c.</span><span class="op">&lt;-</span><span class="va">dmat1.out</span><span class="op">$</span><span class="va">points</span><span class="op">[</span><span class="st">"c"</span>,<span class="op">]</span>

<span class="fu">plot_dist_as_nmds</span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span>
<span class="co">#&gt; $points</span>
<span class="co">#&gt;         [,1]       [,2]</span>
<span class="co">#&gt; a   6.606653  4.9400937</span>
<span class="co">#&gt; b  12.421702 -6.5267890</span>
<span class="co">#&gt; c  -9.532025 12.9665271</span>
<span class="co">#&gt; d -17.839642 -9.0739515</span>
<span class="co">#&gt; e  20.738283  0.4897976</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $eig</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $x</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ac</span>
<span class="co">#&gt; [1] -7.934712e-15</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $GOF</span>
<span class="co">#&gt; [1] 0.6755273 0.9367305</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">a.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,x1 <span class="op">=</span> <span class="va">c.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
         y0 <span class="op">=</span> <span class="va">a.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,y1 <span class="op">=</span> <span class="va">c.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">b.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,x1 <span class="op">=</span> <span class="va">c.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
         y0 <span class="op">=</span> <span class="va">b.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,y1 <span class="op">=</span> <span class="va">c.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>                                    </code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>In UPGMA, we first define a clade. We then need to see which taxa is closest to that clade. Visually it looks like this</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="co"># ab to c</span>
<span class="fu">plot_dist_as_nmds</span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span>
<span class="co">#&gt; $points</span>
<span class="co">#&gt;         [,1]       [,2]</span>
<span class="co">#&gt; a   6.606653  4.9400937</span>
<span class="co">#&gt; b  12.421702 -6.5267890</span>
<span class="co">#&gt; c  -9.532025 12.9665271</span>
<span class="co">#&gt; d -17.839642 -9.0739515</span>
<span class="co">#&gt; e  20.738283  0.4897976</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $eig</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $x</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ac</span>
<span class="co">#&gt; [1] -7.934712e-15</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $GOF</span>
<span class="co">#&gt; [1] 0.6755273 0.9367305</span>

<span class="co">#get x y coord of a and b</span>
<span class="va">a.</span><span class="op">&lt;-</span><span class="va">dmat1.out</span><span class="op">$</span><span class="va">points</span><span class="op">[</span><span class="st">"a"</span>,<span class="op">]</span>
<span class="va">b.</span><span class="op">&lt;-</span><span class="va">dmat1.out</span><span class="op">$</span><span class="va">points</span><span class="op">[</span><span class="st">"b"</span>,<span class="op">]</span>

<span class="fu"><a href="https://rdrr.io/pkg/plotrix/man/draw.ellipse.html">draw.ellipse</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">a.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">b.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, 
             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">a.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="va">b.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,
             a <span class="op">=</span><span class="fl">3</span>, 
             b <span class="op">=</span> <span class="fl">10</span>, 
             angle <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>
<span class="va">c.</span><span class="op">&lt;-</span><span class="va">d2</span><span class="op">$</span><span class="va">points</span><span class="op">[</span><span class="st">"c"</span>,<span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">a.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,x1 <span class="op">=</span> <span class="va">c.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
         y0 <span class="op">=</span> <span class="va">a.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,y1 <span class="op">=</span> <span class="va">c.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">b.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,x1 <span class="op">=</span> <span class="va">c.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
         y0 <span class="op">=</span> <span class="va">b.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,y1 <span class="op">=</span> <span class="va">c.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>  

<span class="co"># ab to d</span>
<span class="fu">plot_dist_as_nmds</span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span>
<span class="co">#&gt; $points</span>
<span class="co">#&gt;         [,1]       [,2]</span>
<span class="co">#&gt; a   6.606653  4.9400937</span>
<span class="co">#&gt; b  12.421702 -6.5267890</span>
<span class="co">#&gt; c  -9.532025 12.9665271</span>
<span class="co">#&gt; d -17.839642 -9.0739515</span>
<span class="co">#&gt; e  20.738283  0.4897976</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $eig</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $x</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ac</span>
<span class="co">#&gt; [1] -7.934712e-15</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $GOF</span>
<span class="co">#&gt; [1] 0.6755273 0.9367305</span>
<span class="fu"><a href="https://rdrr.io/pkg/plotrix/man/draw.ellipse.html">draw.ellipse</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">a.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">b.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, 
             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">a.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="va">b.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,
             a <span class="op">=</span><span class="fl">3</span>, 
             b <span class="op">=</span> <span class="fl">10</span>, 
             angle <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>
<span class="va">d.</span><span class="op">&lt;-</span><span class="va">d2</span><span class="op">$</span><span class="va">points</span><span class="op">[</span><span class="st">"d"</span>,<span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">a.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,x1 <span class="op">=</span> <span class="va">d.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
         y0 <span class="op">=</span> <span class="va">a.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,y1 <span class="op">=</span> <span class="va">d.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">b.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,x1 <span class="op">=</span> <span class="va">d.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
         y0 <span class="op">=</span> <span class="va">b.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,y1 <span class="op">=</span> <span class="va">d.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>  

<span class="co"># ab to e</span>
<span class="fu">plot_dist_as_nmds</span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span>
<span class="co">#&gt; $points</span>
<span class="co">#&gt;         [,1]       [,2]</span>
<span class="co">#&gt; a   6.606653  4.9400937</span>
<span class="co">#&gt; b  12.421702 -6.5267890</span>
<span class="co">#&gt; c  -9.532025 12.9665271</span>
<span class="co">#&gt; d -17.839642 -9.0739515</span>
<span class="co">#&gt; e  20.738283  0.4897976</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $eig</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $x</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ac</span>
<span class="co">#&gt; [1] -7.934712e-15</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $GOF</span>
<span class="co">#&gt; [1] 0.6755273 0.9367305</span>
<span class="fu"><a href="https://rdrr.io/pkg/plotrix/man/draw.ellipse.html">draw.ellipse</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">a.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">b.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, 
             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">a.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="va">b.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,
             a <span class="op">=</span><span class="fl">3</span>, 
             b <span class="op">=</span> <span class="fl">10</span>, 
             angle <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>
<span class="va">e.</span><span class="op">&lt;-</span><span class="va">d2</span><span class="op">$</span><span class="va">points</span><span class="op">[</span><span class="st">"e"</span>,<span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">a.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,x1 <span class="op">=</span> <span class="va">e.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
         y0 <span class="op">=</span> <span class="va">a.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,y1 <span class="op">=</span> <span class="va">e.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">b.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,x1 <span class="op">=</span> <span class="va">e.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
         y0 <span class="op">=</span> <span class="va">b.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,y1 <span class="op">=</span> <span class="va">e.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> </code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
</div>
<div id="algorithm---round-1" class="section level2">
<h2 class="hasAnchor">
<a href="#algorithm---round-1" class="anchor"></a>Algorithm - round 1</h2>
<p>We will now implement the algorithm.</p>
<p>NOTE: I am not using a consistent system of nomeclature - I am mixing my own conventions with hose of Swofford et al. Sorry :(</p>
<p>First we’ll need a dataframe to hold tings</p>
<ul>
<li>it = iteration</li>
<li>clust.i, clust.j = the two taxa or clades being combined</li>
<li>dist.ij = value from distnace matrix between the taxa</li>
<li>clust.u = name of the new combined cluster (clade)</li>
<li>branch.l.ij = branch lengths</li>
</ul>
<p>A matrix to hold things as I work</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n.taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span>
<span class="va">UPGMA_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>it <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n.taxa</span><span class="op">)</span>,
                           clust.i <span class="op">=</span> <span class="cn">NA</span>,
                           clust.j <span class="op">=</span> <span class="cn">NA</span>,
                           dist.ij <span class="op">=</span> <span class="cn">NA</span>,
                           clust.u <span class="op">=</span> <span class="cn">NA</span>,
                           branch.l.ij <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></code></pre></div>
<div id="determine-minimum-value-in-current-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#determine-minimum-value-in-current-matrix" class="anchor"></a>Determine minimum value in current matrix</h3>
<p>The minimum distance using the min() function</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dist.min.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">dmat1</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>The index value of the minimum, using which()</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">index.min.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">dmat1</span> <span class="op">==</span> <span class="va">dist.min.i</span>, arr.ind <span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="va">index.row.i</span> <span class="op">&lt;-</span> <span class="va">index.min.i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">index.col.i</span> <span class="op">&lt;-</span> <span class="va">index.min.i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></code></pre></div>
<p>We can get the names of our taxa using rownames() and colnames()</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cluster.i2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span><span class="op">[</span><span class="va">index.row.i</span><span class="op">]</span>
<span class="va">cluster.i1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dmat1</span><span class="op">)</span><span class="op">[</span><span class="va">index.col.i</span><span class="op">]</span></code></pre></div>
<p>Add output to dataframe</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the clusters we're working iwth</span>
<span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"clust.i"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cluster.i1</span>
<span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"clust.j"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cluster.i2</span>

<span class="co"># the distance between them</span>
<span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"dist.ij"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">dist.min.i</span></code></pre></div>
</div>
<div id="combine-species-into-clade" class="section level3">
<h3 class="hasAnchor">
<a href="#combine-species-into-clade" class="anchor"></a>Combine species into clade</h3>
<p>Combine the two taxa names into a new name. This can be done a couple ways.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># name of our clade</span>

<span class="co">## hard-code "ab"</span>
<span class="va">clade.i</span> <span class="op">&lt;-</span> <span class="st">"ab"</span>

<span class="co">## use paste() to generate name</span>
<span class="va">clade.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span>,sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="co">## general, re-usable code using paste() and object names</span>
<span class="va">clade.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">cluster.i1</span>,<span class="va">cluster.i2</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p>We’ll add this to the dataframe</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"clust.u"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">clade.i</span></code></pre></div>
<p>Look at things so far</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span>
<span class="co">#&gt;   it clust.i clust.j dist.ij clust.u branch.l.ij</span>
<span class="co">#&gt; 1  1       a       b      17      ab          NA</span>
<span class="co">#&gt; 2  2    &lt;NA&gt;    &lt;NA&gt;      NA    &lt;NA&gt;          NA</span>
<span class="co">#&gt; 3  3    &lt;NA&gt;    &lt;NA&gt;      NA    &lt;NA&gt;          NA</span>
<span class="co">#&gt; 4  4    &lt;NA&gt;    &lt;NA&gt;      NA    &lt;NA&gt;          NA</span>
<span class="co">#&gt; 5  5    &lt;NA&gt;    &lt;NA&gt;      NA    &lt;NA&gt;          NA</span></code></pre></div>
</div>
<div id="calculate-branch-length" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-branch-length" class="anchor"></a>Calculate branch length</h3>
<p>Branch length is the distance between the two taxa: distance/2 or d.ij/2</p>
<p>We can access the distance in our first row of the matrix like this</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"dist.ij"</span><span class="op">]</span>
<span class="co">#&gt; [1] 17</span></code></pre></div>
<p>We can divided the distance betyween a and b by 2 to get our branch length like this</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"dist.ij"</span><span class="op">]</span><span class="op">/</span><span class="fl">2</span>
<span class="co">#&gt; [1] 8.5</span></code></pre></div>
<p>Now store the distance d in the dataframe</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"branch.l.ij"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"dist.ij"</span><span class="op">]</span><span class="op">/</span><span class="fl">2</span></code></pre></div>
<p>We’ve now completed our first round of calculations</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span>
<span class="co">#&gt;   it clust.i clust.j dist.ij clust.u branch.l.ij</span>
<span class="co">#&gt; 1  1       a       b      17      ab         8.5</span>
<span class="co">#&gt; 2  2    &lt;NA&gt;    &lt;NA&gt;      NA    &lt;NA&gt;          NA</span>
<span class="co">#&gt; 3  3    &lt;NA&gt;    &lt;NA&gt;      NA    &lt;NA&gt;          NA</span>
<span class="co">#&gt; 4  4    &lt;NA&gt;    &lt;NA&gt;      NA    &lt;NA&gt;          NA</span>
<span class="co">#&gt; 5  5    &lt;NA&gt;    &lt;NA&gt;      NA    &lt;NA&gt;          NA</span></code></pre></div>
</div>
<div id="calculate-distance-from-clade-to-all-other-points" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-distance-from-clade-to-all-other-points" class="anchor"></a>Calculate distance from clade to all other points</h3>
<p>Distance (ab) to all other points</p>
<ul>
<li>ab to c</li>
<li>ab to d</li>
<li>ab to e</li>
</ul>
<div id="ab-to-c" class="section level4">
<h4 class="hasAnchor">
<a href="#ab-to-c" class="anchor"></a>ab to c</h4>
<p>This is calculated at the average of the distance</p>
<ul>
<li>from a to c, and</li>
<li>from b to c.</li>
</ul>
<p>In the Wikipedia article the math is framed like this</p>
<p>D(ab to c) = [D(a to c) + D(b to c)] / 2 D(ab to c) = [ 21 + 30 ] / 2 D(ab to c) = [ 21 + 30 ] / 2 D(ab to c) = 25.5</p>
<p>Dab_c = [Da_c + Db_c] / 2 Dab_c = 25.5</p>
<p>The math in the wikipedia article is more accurately written out as this, which is more similar to Swofford’s notation.</p>
<p>D(ab to c) = [T.i<em>D(a to c) + T.j</em>D(b to c)] / 2 D(ab to c) = [1<em>D(a to c) + 1</em>D(b to c)] / (1+1) D(ab to c) = [ 1<em>21 + 1</em>30 ] / (1+1) D(ab to c) = [ 1<em>21 + 1</em>30 ] / (1+1) D(ab to c) = 25.5</p>
<p>Dab_c = [1<em>Da_c + 1</em>Db_c] / (1+1) Dab_c = 25.5</p>
<p>Using Swofford et al’s notation we’d do this:</p>
<p>d.ku = (Ti x d.ki + Tj x d.kj)/(Ti + Tj)</p>
<p>I’ll just switch the subscripts to be consistent with the Wikipedia notation</p>
<p>d.uk = (Ti x d.ik + Tj x d.jk)/(Ti + Tj)</p>
<p>where</p>
<p>u = our new cluster ab k = the remaining clusters; we’ll start with c Ti, Tj = the number of clusters the constitute the clusters that were just combined. This starts out at 1. Ti = Ta = 1 Tj = Tb = 1 d.ik = the distance from cluster i to the reamining clusters; we’ll start with c d.ik = d.ac = 21 d.jk = d.bc = 30</p>
<p>d.ku = (Ti x d.ik + Tj x d.jk)/(Ti + Tj) d.ku = (1 x 21 + 1 x 30 )/( 1 + 1 ) d.ku = ( 21 + 30 )/(2) d.ku = 51/2 d.ku = 25.5</p>
<p>The Swofford notation is more generic and useful because in the next iteration we’ll have a cluster of ab which will have two taxa in it.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Ta</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">Tb</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">Da_c</span> <span class="op">&lt;-</span> <span class="fl">21</span>
<span class="va">Db_c</span> <span class="op">&lt;-</span> <span class="fl">30</span>
<span class="va">Dab_c</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Ta</span><span class="op">*</span><span class="va">Da_c</span><span class="op">+</span><span class="va">Tb</span><span class="op">*</span><span class="va">Db_c</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></code></pre></div>
</div>
<div id="ab-to-d" class="section level4">
<h4 class="hasAnchor">
<a href="#ab-to-d" class="anchor"></a>ab to d</h4>
<p>We now continue for the other distances. I’ll stick to the wikipedia notation for now.</p>
<p>D(ab to d) = [D(a to d) + D(b to d)] / 2 D(ab to d) = [ 31 + 34 ] / 2 D(ab to d) = [ 31 + 34 ] / 2 D(ab to d) = 32.5</p>
<p>Dab_d = [Da_d + Db_d] / 2 Dab_d = 32.5</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Da_d</span> <span class="op">&lt;-</span> <span class="fl">31</span>
<span class="va">Db_d</span> <span class="op">&lt;-</span> <span class="fl">34</span>
<span class="va">Dab_d</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Da_d</span><span class="op">+</span><span class="va">Db_d</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></code></pre></div>
</div>
<div id="ab-to-e" class="section level4">
<h4 class="hasAnchor">
<a href="#ab-to-e" class="anchor"></a>ab to e</h4>
<p>D(ab to d) = [D(a to d) + D(b to d)] / 2 D(ab to d) = [ 23 + 21 ] / 2 D(ab to d) = [ 23 + 21 ] / 2 D(ab to d) = Dab_e</p>
<p>Dab_d = [Da_d + Db_d] / 2 Dab_d = Dab_e</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">Da_e</span> <span class="op">&lt;-</span> <span class="fl">23</span>
<span class="va">Db_e</span> <span class="op">&lt;-</span> <span class="fl">21</span>
<span class="va">Dab_e</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Da_e</span><span class="op">+</span><span class="va">Db_e</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></code></pre></div>
</div>
</div>
<div id="update-matrix-with-new-distance" class="section level3">
<h3 class="hasAnchor">
<a href="#update-matrix-with-new-distance" class="anchor"></a>Update matrix with new distance</h3>
<p>Old matrix has distances from a and b to all other points: we want to replace these. distances among c, d, and e are still the same values.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dmat1</span>
<span class="co">#&gt;    a  b  c  d  e</span>
<span class="co">#&gt; a NA NA NA NA NA</span>
<span class="co">#&gt; b 17 NA NA NA NA</span>
<span class="co">#&gt; c 21 30 NA NA NA</span>
<span class="co">#&gt; d 31 34 28 NA NA</span>
<span class="co">#&gt; e 23 21 39 43 NA</span></code></pre></div>
<div id="illustration" class="section level4">
<h4 class="hasAnchor">
<a href="#illustration" class="anchor"></a>Illustration</h4>
<p>Values in parenthesese will be REPLACED</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"(17)"</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>
<span class="va">c</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"(21)"</span>, <span class="st">"(30)"</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>
<span class="va">d</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"(31)"</span>, <span class="st">"(34)"</span>, <span class="st">"28"</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>
<span class="va">e</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"(23)"</span>, <span class="st">"(21)"</span>, <span class="st">"39"</span>, <span class="st">"43"</span>,    <span class="cn">NA</span><span class="op">)</span>
<span class="va">dmat1.alt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span>,<span class="va">c</span>,<span class="va">d</span>,<span class="va">e</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dmat1.alt</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span>,<span class="st">"d"</span>,<span class="st">"e"</span><span class="op">)</span>
<span class="va">dmat1.alt</span>
<span class="co">#&gt;   a      b      c    d    e </span>
<span class="co">#&gt; a NA     NA     NA   NA   NA</span>
<span class="co">#&gt; b "(17)" NA     NA   NA   NA</span>
<span class="co">#&gt; c "(21)" "(30)" NA   NA   NA</span>
<span class="co">#&gt; d "(31)" "(34)" "28" NA   NA</span>
<span class="co">#&gt; e "(23)" "(21)" "39" "43" NA</span></code></pre></div>
<p>Create smaller matrix with clade ab</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#       ab      c   d   e</span>
<span class="va">ab</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,    <span class="cn">NA</span>,  <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>
<span class="va">c</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Dab_c</span>, <span class="cn">NA</span>,  <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>
<span class="va">d</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Dab_d</span>, <span class="fl">28</span>,    <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>
<span class="va">e</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Dab_e</span>, <span class="fl">39</span>,  <span class="fl">43</span>, <span class="cn">NA</span><span class="op">)</span>

<span class="va">dmat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ab</span>,<span class="va">c</span>,<span class="va">d</span>,<span class="va">e</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dmat2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ab"</span>,<span class="st">"c"</span>,<span class="st">"d"</span>,<span class="st">"e"</span><span class="op">)</span></code></pre></div>
</div>
<div id="estimate-2-d" class="section level4">
<h4 class="hasAnchor">
<a href="#estimate-2-d" class="anchor"></a>Estimate 2 D</h4>
<p>Estimate of 2D representation of the new matrix.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu">plot_dist_as_nmds</span><span class="op">(</span><span class="va">dmat2</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-40-1.png" width="700"></p>
<pre><code>#&gt; $points
#&gt;          [,1]       [,2]
#&gt; ab  13.453890 -3.0373250
#&gt; c   -6.600828 13.4680501
#&gt; d  -16.726270 -8.5744114
#&gt; e   19.948871 -0.6844397
#&gt; 
#&gt; $eig
#&gt; NULL
#&gt; 
#&gt; $x
#&gt; NULL
#&gt; 
#&gt; $ac
#&gt; [1] -4.570935e-15
#&gt; 
#&gt; $GOF
#&gt; [1] 0.7573625 1.0000000</code></pre>
</div>
</div>
</div>
<div id="algorithm---next-round" class="section level2">
<h2 class="hasAnchor">
<a href="#algorithm---next-round" class="anchor"></a>Algorithm - next round</h2>
<p>We’ve combined a and b and calculated the disnace of this clade (a,b) to the remaining taxa. What is now the minimum distance?</p>
<p>The minimum distance of the current matrix</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dist.min.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">dmat2</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>The index value of the current minimum</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">index.min.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">dmat2</span> <span class="op">==</span> <span class="va">dist.min.i</span>, arr.ind <span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="va">index.row.i</span> <span class="op">&lt;-</span> <span class="va">index.min.i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">index.col.i</span> <span class="op">&lt;-</span> <span class="va">index.min.i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></code></pre></div>
<p>We can get the names of our taxa using the</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cluster.i2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dmat2</span><span class="op">)</span><span class="op">[</span><span class="va">index.row.i</span><span class="op">]</span>
<span class="va">cluster.i1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dmat2</span><span class="op">)</span><span class="op">[</span><span class="va">index.col.i</span><span class="op">]</span></code></pre></div>
<p>Add output to dataframe</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">2</span>,<span class="st">"clust.i"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cluster.i1</span>
<span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">2</span>,<span class="st">"clust.j"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cluster.i2</span>
<span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">2</span>,<span class="st">"dist.ij"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">dist.min.i</span></code></pre></div>
<div id="combine-species-into-clade-1" class="section level3">
<h3 class="hasAnchor">
<a href="#combine-species-into-clade-1" class="anchor"></a>Combine species into clade</h3>
<p>Combine the two taxa names into a new name. This can be done a couple ways.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clade.i</span> <span class="op">&lt;-</span> <span class="st">"abe"</span>
<span class="va">clade.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"ab"</span>,<span class="st">"e"</span>,sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">clade.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">cluster.i1</span>,<span class="va">cluster.i2</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p>We’ll add this to the dataframe</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">2</span>,<span class="st">"clust.u"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">clade.i</span></code></pre></div>
</div>
<div id="calculate-branch-length-1" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-branch-length-1" class="anchor"></a>Calculate branch length</h3>
<p>Branch length is distance/2 or d.ij/2 = d.ab.e = 22/2</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">2</span>,<span class="st">"branch.l.ij"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">2</span>,<span class="st">"dist.ij"</span><span class="op">]</span><span class="op">/</span><span class="fl">2</span></code></pre></div>
</div>
<div id="recalculate-distance-from-abe-to-all-remainign-taxa" class="section level3">
<h3 class="hasAnchor">
<a href="#recalculate-distance-from-abe-to-all-remainign-taxa" class="anchor"></a>Recalculate distance from abe to all remainign taxa</h3>
<p>In the current matrix, the smallest distance is between ab and e</p>
<p>We therefore want to form a clade between ab and e (abe), the measure the distance from this clade to allthe other species.</p>
<p>Visualize this as an approximate 2D situation</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">dmat2.out</span> <span class="op">&lt;-</span> <span class="fu">plot_dist_as_nmds</span><span class="op">(</span><span class="va">dmat2</span><span class="op">)</span>

<span class="co">#get x y coord of ab and e</span>
<span class="va">ab.</span><span class="op">&lt;-</span><span class="va">dmat2.out</span><span class="op">$</span><span class="va">points</span><span class="op">[</span><span class="st">"ab"</span>,<span class="op">]</span>
<span class="va">e.</span><span class="op">&lt;-</span><span class="va">dmat2.out</span><span class="op">$</span><span class="va">points</span><span class="op">[</span><span class="st">"e"</span>,<span class="op">]</span>

<span class="fu"><a href="https://rdrr.io/pkg/plotrix/man/draw.ellipse.html">draw.ellipse</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ab.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">e.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, 
             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ab.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="va">e.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,
             a <span class="op">=</span><span class="fl">7</span>, 
             b <span class="op">=</span> <span class="fl">7</span>, 
             angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">c.</span><span class="op">&lt;-</span><span class="va">dmat2.out</span><span class="op">$</span><span class="va">points</span><span class="op">[</span><span class="st">"c"</span>,<span class="op">]</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">ab.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,x1 <span class="op">=</span> <span class="va">c.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
         y0 <span class="op">=</span> <span class="va">ab.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,y1 <span class="op">=</span> <span class="va">c.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">e.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,x1 <span class="op">=</span> <span class="va">c.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
         y0 <span class="op">=</span> <span class="va">e.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,y1 <span class="op">=</span> <span class="va">c.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> </code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-48-1.png" width="700"></p>
<div id="abe-to-c" class="section level4">
<h4 class="hasAnchor">
<a href="#abe-to-c" class="anchor"></a>abe to c</h4>
<p>NOTE: calculations are “weighted” in proportion number of species in clade. So D(ab to c) is multiplied by two because ab is 2 species</p>
<p>The denominators is 3 because of the weights used in the numerator.</p>
<p>The notation in the Wikipedia article is:</p>
<p>D(abe to c) = [D(ab to c)<em>2 + D(e to c)</em>1] / (2+1) D(abe to c) = [ 25.5<em>2 + 39</em>1 ] / (2+1) D(abe to c) = [ 25.5<em>2 + 39</em>1 ] / (2+1) D(abe to c) = 32.5</p>
<p>Dabe_c = [Dab_c<em>2 + De_c</em>1] / (2+1) Dabe_c = 32.5</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Dab_c</span> <span class="op">&lt;-</span> <span class="fl">25.5</span>
<span class="va">De_c</span>  <span class="op">&lt;-</span> <span class="fl">39</span>
<span class="va">Dabe_c</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Dab_c</span><span class="op">*</span><span class="fl">2</span> <span class="op">+</span> <span class="va">De_c</span><span class="op">*</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div id="abe-to-c-1" class="section level4">
<h4 class="hasAnchor">
<a href="#abe-to-c-1" class="anchor"></a>abe to c</h4>
<p>For abe to d</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Dab_d</span> <span class="op">&lt;-</span> <span class="fl">32.5</span>
<span class="va">De_d</span>  <span class="op">&lt;-</span> <span class="fl">43</span>
<span class="va">Dabe_d</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Dab_d</span><span class="op">*</span><span class="fl">2</span> <span class="op">+</span> <span class="va">De_d</span><span class="op">*</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="update-the-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#update-the-matrix" class="anchor"></a>Update the matrix</h3>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">abe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,     <span class="cn">NA</span>,  <span class="cn">NA</span><span class="op">)</span>
<span class="va">c</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Dabe_c</span>, <span class="cn">NA</span>,  <span class="cn">NA</span><span class="op">)</span>
<span class="va">d</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Dabe_d</span>, <span class="fl">28</span>,  <span class="cn">NA</span><span class="op">)</span>


<span class="va">dmat3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">abe</span>,<span class="va">c</span>,<span class="va">d</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dmat3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"abe"</span>,<span class="st">"c"</span>,<span class="st">"d"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="next-iteration" class="section level2">
<h2 class="hasAnchor">
<a href="#next-iteration" class="anchor"></a>Next iteration</h2>
<div id="estimate-2-d-1" class="section level4">
<h4 class="hasAnchor">
<a href="#estimate-2-d-1" class="anchor"></a>Estimate 2 D</h4>
<p>a, b, e are now combined into a clade</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">dmat3.out</span> <span class="op">&lt;-</span> <span class="fu">plot_dist_as_nmds</span><span class="op">(</span><span class="va">dmat3</span><span class="op">)</span>

<span class="co">#get x y coord of ab and e</span>
<span class="va">c.</span> <span class="op">&lt;-</span><span class="va">dmat3.out</span><span class="op">$</span><span class="va">points</span><span class="op">[</span><span class="st">"c"</span>,<span class="op">]</span>
<span class="va">d.</span><span class="op">&lt;-</span><span class="va">dmat3.out</span><span class="op">$</span><span class="va">points</span><span class="op">[</span><span class="st">"d"</span>,<span class="op">]</span>

<span class="fu"><a href="https://rdrr.io/pkg/plotrix/man/draw.ellipse.html">draw.ellipse</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">c.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">d.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, 
             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">c.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="va">d.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,
             a <span class="op">=</span><span class="fl">14</span>, 
             b <span class="op">=</span> <span class="fl">4</span>, 
             angle <span class="op">=</span> <span class="fl">105</span><span class="op">)</span>
<span class="va">abe.</span><span class="op">&lt;-</span><span class="va">dmat3.out</span><span class="op">$</span><span class="va">points</span><span class="op">[</span><span class="st">"abe"</span>,<span class="op">]</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">c.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,x1 <span class="op">=</span> <span class="va">abe.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
         y0 <span class="op">=</span> <span class="va">c.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,y1 <span class="op">=</span> <span class="va">abe.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">d.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,x1 <span class="op">=</span> <span class="va">abe.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
         y0 <span class="op">=</span> <span class="va">d.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,y1 <span class="op">=</span> <span class="va">abe.</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> </code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-52-1.png" width="700"></p>
</div>
<div id="calculate-branch-lengths" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-branch-lengths" class="anchor"></a>Calculate branch lengths</h3>
<p>The minimum distance of the current matrix</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dist.min.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">dmat3</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>The index value of the current minimum</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">index.min.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">dmat3</span> <span class="op">==</span> <span class="va">dist.min.i</span>, arr.ind <span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="va">index.row.i</span> <span class="op">&lt;-</span> <span class="va">index.min.i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">index.col.i</span> <span class="op">&lt;-</span> <span class="va">index.min.i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></code></pre></div>
<p>We can get the names of our taxa using the</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cluster.i2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dmat3</span><span class="op">)</span><span class="op">[</span><span class="va">index.row.i</span><span class="op">]</span>
<span class="va">cluster.i1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dmat3</span><span class="op">)</span><span class="op">[</span><span class="va">index.col.i</span><span class="op">]</span></code></pre></div>
<p>Add output to dataframe</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">3</span>,<span class="st">"clust.i"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cluster.i1</span>
<span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">3</span>,<span class="st">"clust.j"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cluster.i2</span>
<span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">3</span>,<span class="st">"dist.ij"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">dist.min.i</span></code></pre></div>
</div>
<div id="combine-species-into-clade-2" class="section level3">
<h3 class="hasAnchor">
<a href="#combine-species-into-clade-2" class="anchor"></a>Combine species into clade</h3>
<p>Combine the two taxa names into a new name. This can be done a couple ways.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clade.i</span> <span class="op">&lt;-</span> <span class="st">"cd"</span>
<span class="va">clade.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"c"</span>,<span class="st">"d"</span>,sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">clade.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">cluster.i1</span>,<span class="va">cluster.i2</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p>We’ll add this to the dataframe</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">3</span>,<span class="st">"clust.u"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">clade.i</span></code></pre></div>
</div>
<div id="calculate-branch-length-2" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-branch-length-2" class="anchor"></a>Calculate branch length</h3>
<p>Branch length is distance/2 or d.ij/2 = d.d.e = 28/2</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">3</span>,<span class="st">"branch.l.ij"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">3</span>,<span class="st">"dist.ij"</span><span class="op">]</span><span class="op">/</span><span class="fl">2</span></code></pre></div>
</div>
<div id="distance-of-c-to-abe-and-d-to-abe" class="section level3">
<h3 class="hasAnchor">
<a href="#distance-of-c-to-abe-and-d-to-abe" class="anchor"></a>Distance of c to abe and d to abe</h3>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Dc_abe</span> <span class="op">&lt;-</span> <span class="fl">30</span>
<span class="va">Dd_abe</span> <span class="op">&lt;-</span> <span class="fl">36</span>

<span class="co"># abe is composted of 3 </span>
<span class="va">Ddc_abe</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Dc_abe</span><span class="op">*</span><span class="fl">3</span> <span class="op">+</span> <span class="va">Dd_abe</span><span class="op">*</span><span class="fl">3</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">3</span><span class="op">+</span><span class="fl">3</span><span class="op">)</span>

<span class="co"># factor out 3</span>
<span class="va">Ddc_abe</span> <span class="op">&lt;-</span> <span class="fl">3</span><span class="op">*</span><span class="op">(</span><span class="va">Dc_abe</span><span class="op">*</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Dd_abe</span><span class="op">*</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">6</span>

<span class="co"># simplify</span>
<span class="va">Ddc_abe</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">*</span><span class="op">(</span><span class="va">Dc_abe</span><span class="op">*</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Dd_abe</span><span class="op">*</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>
<span class="va">Ddc_abe</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Dc_abe</span><span class="op">*</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Dd_abe</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></code></pre></div>
<p>Create matrix</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">abe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,     <span class="cn">NA</span><span class="op">)</span>
<span class="va">cd</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Ddc_abe</span>, <span class="cn">NA</span><span class="op">)</span>



<span class="va">dmat4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">abe</span>,<span class="va">cd</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dmat4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"abe"</span>,<span class="st">"cd"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="finish-up" class="section level2">
<h2 class="hasAnchor">
<a href="#finish-up" class="anchor"></a>Finish up</h2>
<p>The final entry of the matrix is 33. This means that the distnace from the clade abe to the clade de is 33, with branch length of 33/2 = 16.5</p>
<p>The minimum distance</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dist.min.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">dmat4</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>The index value of the minimum</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">index.min.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">dmat4</span> <span class="op">==</span> <span class="va">dist.min.i</span>, arr.ind <span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="va">index.row.i</span> <span class="op">&lt;-</span> <span class="va">index.min.i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">index.col.i</span> <span class="op">&lt;-</span> <span class="va">index.min.i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></code></pre></div>
<p>We can get the names of our taxa using the</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cluster.i2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dmat4</span><span class="op">)</span><span class="op">[</span><span class="va">index.row.i</span><span class="op">]</span>
<span class="va">cluster.i1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dmat4</span><span class="op">)</span><span class="op">[</span><span class="va">index.col.i</span><span class="op">]</span></code></pre></div>
<p>Add output to dataframe</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">4</span>,<span class="st">"clust.i"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cluster.i1</span>
<span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">4</span>,<span class="st">"clust.j"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cluster.i2</span>
<span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">4</span>,<span class="st">"dist.ij"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">dist.min.i</span></code></pre></div>
<div id="combine-species-into-clade-3" class="section level3">
<h3 class="hasAnchor">
<a href="#combine-species-into-clade-3" class="anchor"></a>Combine species into clade</h3>
<p>Combine the two taxa names into a new name. This can be done a couple ways.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clade.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">cluster.i1</span>,<span class="va">cluster.i2</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p>We’ll add this to the dataframe</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">4</span>,<span class="st">"clust.u"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">clade.i</span></code></pre></div>
</div>
<div id="calculate-branch-length-3" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-branch-length-3" class="anchor"></a>Calculate branch length</h3>
<p>Branch length is distance/2 or d.ij/2</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">4</span>,<span class="st">"branch.l.ij"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">UPGMA_output</span><span class="op">[</span><span class="fl">4</span>,<span class="st">"dist.ij"</span><span class="op">]</span><span class="op">/</span><span class="fl">2</span></code></pre></div>
</div>
</div>
<div id="finalizing-branch-lengths" class="section level2">
<h2 class="hasAnchor">
<a href="#finalizing-branch-lengths" class="anchor"></a>Finalizing branch lengths</h2>
<p>We now have a final tree structure. In Newick format it would be</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">full.tree</span> <span class="op">&lt;-</span> <span class="st">"((c,d),(e,(b, a)));"</span> <span class="co"># semi colon!</span>
<span class="va">full.tree</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html">read.tree</a></span><span class="op">(</span>text<span class="op">=</span><span class="va">full.tree</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">full.tree</span>, main <span class="op">=</span> <span class="st">"3-taxa tree"</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-69-1.png" width="700"></p>
<p>While we’ve done our clustering we’ve calcualte branch lengths and put them in the column branch.l.ij of the dataframe UPGMA_output</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UPGMA_output</span>
<span class="co">#&gt;   it clust.i clust.j dist.ij clust.u branch.l.ij</span>
<span class="co">#&gt; 1  1       a       b      17      ab         8.5</span>
<span class="co">#&gt; 2  2      ab       e      22     abe        11.0</span>
<span class="co">#&gt; 3  3       c       d      28      cd        14.0</span>
<span class="co">#&gt; 4  4     abe      cd      33   abecd        16.5</span>
<span class="co">#&gt; 5  5    &lt;NA&gt;    &lt;NA&gt;      NA    &lt;NA&gt;          NA</span></code></pre></div>
<p>The following code adds them to the tree.</p>
<p>First, the brnach lenghts from a to b</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">full.tree</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="co"># a-b branch lengths= 8.5</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">5.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">4.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-71-1.png" width="700"></p>
<p>now a to b, and ab to e</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">full.tree</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="co"># a-b branch lengths= 8.5</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">5.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">4.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="co"># ab-e branch lengths= 1</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">3.1</span>,labels <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-72-1.png" width="700"></p>
<p>There’s a branch between the clade ab and the node that connects with e. What’s its length? FOr a simple ultrametric tree calcualted with UPGMA we can calculate this by subtraction</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fl">11</span><span class="op">-</span><span class="fl">8.5</span>
<span class="co">#&gt; [1] 2.5</span></code></pre></div>
<p>We’ll added this short branch of 2.5. Note this things ARE NOT to scale.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">full.tree</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="co"># a-b branch lengths= 8.5</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">5.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">4.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="co"># ab-e branch lengths= 1</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">3.1</span>,labels <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>

<span class="co"># short branch</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2.5</span>,y <span class="op">=</span> <span class="fl">4.6</span>,labels <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-74-1.png" width="700"></p>
<p>To visualize exactly what is going on here its useful to add this</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">full.tree</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="co"># a-b branch lengths= 8.5</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">4.9</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">4.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="co"># ab-e branch lengths= 1</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">3.1</span>,labels <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>

<span class="co"># short branch</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2.5</span>,y <span class="op">=</span> <span class="fl">4.6</span>,labels <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">2</span>,x1 <span class="op">=</span> <span class="fl">4</span>,y0 <span class="op">=</span><span class="fl">5.15</span>,y1<span class="op">=</span><span class="fl">5.15</span>, code <span class="op">=</span><span class="fl">3</span>,angle <span class="op">=</span> <span class="fl">90</span>,length <span class="op">=</span><span class="fl">0.1</span>, lty <span class="op">=</span><span class="fl">2</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2.5</span>,y <span class="op">=</span> <span class="fl">5</span>,labels <span class="op">=</span> <span class="st">"2.5+8.5=11"</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-75-1.png" width="700"></p>
<p>We can now add the d-e branch of 14 (note again - not to scale!)</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">full.tree</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="co"># a-b branch lengths= 8.5</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">5.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">4.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="co"># ab-e branch lengths= 1</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">3.1</span>,labels <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>

<span class="co"># short branch</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2.5</span>,y <span class="op">=</span> <span class="fl">4.6</span>,labels <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span>

<span class="co"># d-e branch</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">1.1</span>,labels <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">2.1</span>,labels <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-76-1.png" width="700"></p>
<p>The distance from abe to de is 16.5 We can visualize this as</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">full.tree</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="co"># a-b branch lengths= 8.5</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">5.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">4.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="co"># ab-e branch lengths= 1</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">3.1</span>,labels <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>

<span class="co"># short branch</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2.5</span>,y <span class="op">=</span> <span class="fl">4.6</span>,labels <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span>

<span class="co"># d-e branch</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">1.1</span>,labels <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">2.1</span>,labels <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>


<span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">0</span>,x1 <span class="op">=</span> <span class="fl">4</span>,y0 <span class="op">=</span><span class="fl">0.85</span>,y1<span class="op">=</span><span class="fl">0.85</span>, code <span class="op">=</span><span class="fl">3</span>,angle <span class="op">=</span> <span class="fl">90</span>,length <span class="op">=</span><span class="fl">0.1</span>, lty <span class="op">=</span><span class="fl">2</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>,y <span class="op">=</span> <span class="fl">1</span>,labels <span class="op">=</span> <span class="fl">16.5</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-77-1.png" width="700"></p>
<p>We can calcualte the distance of the remaining short branch from de to the root as 16.5-14 = 2.5. When we plot this again, it won’t be to scale</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">full.tree</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="co"># a-b branch lengths= 8.5</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">5.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">4.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="co"># ab-e branch lengths= 1</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">3.1</span>,labels <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>

<span class="co"># short branch</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2.5</span>,y <span class="op">=</span> <span class="fl">4.6</span>,labels <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span>

<span class="co"># d-e branch</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">1.1</span>,labels <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">2.1</span>,labels <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>


<span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">0</span>,x1 <span class="op">=</span> <span class="fl">4</span>,y0 <span class="op">=</span><span class="fl">0.85</span>,y1<span class="op">=</span><span class="fl">0.85</span>, code <span class="op">=</span><span class="fl">3</span>,angle <span class="op">=</span> <span class="fl">90</span>,length <span class="op">=</span><span class="fl">0.1</span>, lty <span class="op">=</span><span class="fl">2</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>,y <span class="op">=</span> <span class="fl">1</span>,labels <span class="op">=</span> <span class="st">"16.5 - 14 = 2.5"</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-78-1.png" width="700"></p>
<p>We can calculate the remaining short branch from abe to the root as 16.5-8.5-2.5 =16.5-11 =5.5</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">full.tree</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="co"># a-b branch lengths= 8.5</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">5.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">4.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="co"># ab-e branch lengths= 1</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">3.1</span>,labels <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>

<span class="co"># short branch</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2.5</span>,y <span class="op">=</span> <span class="fl">4.6</span>,labels <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span>

<span class="co"># d-e branch</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">1.1</span>,labels <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">2.1</span>,labels <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>


<span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">0</span>,x1 <span class="op">=</span> <span class="fl">4</span>,y0 <span class="op">=</span><span class="fl">0.85</span>,y1<span class="op">=</span><span class="fl">0.85</span>, code <span class="op">=</span><span class="fl">3</span>,angle <span class="op">=</span> <span class="fl">90</span>,length <span class="op">=</span><span class="fl">0.1</span>, lty <span class="op">=</span><span class="fl">2</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>,y <span class="op">=</span> <span class="fl">1</span>,labels <span class="op">=</span> <span class="st">"16.5 - 14 = 2.5"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">0</span>,x1 <span class="op">=</span> <span class="fl">4</span>,y0 <span class="op">=</span><span class="fl">5.1</span>,y1<span class="op">=</span><span class="fl">5.1</span>, code <span class="op">=</span><span class="fl">3</span>,angle <span class="op">=</span> <span class="fl">90</span>,length <span class="op">=</span><span class="fl">0.1</span>, lty <span class="op">=</span><span class="fl">2</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>,y <span class="op">=</span> <span class="fl">5</span>,labels <span class="op">=</span> <span class="st">"16.5 - 8.5 - 2.5 = 5.5"</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-79-1.png" width="700"></p>
<p>So the final tree has branch lengths (not to scale!) of</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">full.tree</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="co"># a-b branch lengths= 8.5</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">5.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">4.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="co"># ab-e branch lengths= 1</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">3.1</span>,labels <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>

<span class="co"># short branch</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2.5</span>,y <span class="op">=</span> <span class="fl">4.6</span>,labels <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span>

<span class="co"># d-e branch</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">1.1</span>,labels <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>,y <span class="op">=</span> <span class="fl">2.1</span>,labels <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>



<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>,y <span class="op">=</span> <span class="fl">1.6</span>,labels <span class="op">=</span> <span class="st">"2.5"</span><span class="op">)</span>


<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>,y <span class="op">=</span> <span class="fl">4</span>,labels <span class="op">=</span> <span class="st">"5.5"</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-80-1.png" width="700"></p>
<p>Most of the time we don’t include branch lengths in Newick format, but there is a way to do it. You don’t need to know how to do this - this is just for illustration</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">full.tree</span> <span class="op">&lt;-</span> <span class="st">"((c:14,d:14):2.5,(e:11,(b:8.5, a:8.5):2.5):5.5);"</span> <span class="co"># semi colon!</span>
<span class="va">full.tree</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html">read.tree</a></span><span class="op">(</span>text<span class="op">=</span><span class="va">full.tree</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">full.tree</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">10</span>,y <span class="op">=</span> <span class="fl">5.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">10</span>,y <span class="op">=</span> <span class="fl">4.1</span>,labels <span class="op">=</span> <span class="fl">8.5</span><span class="op">)</span>
<span class="co"># ab-e branch lengths= 1</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">10</span>,y <span class="op">=</span> <span class="fl">3.1</span>,labels <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>

<span class="co"># short branch</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">7</span>,y <span class="op">=</span> <span class="fl">4.6</span>,labels <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span>

<span class="co"># d-e branch</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">10</span>,y <span class="op">=</span> <span class="fl">1.1</span>,labels <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">10</span>,y <span class="op">=</span> <span class="fl">2.1</span>,labels <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>



<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1.5</span>,y <span class="op">=</span> <span class="fl">1.6</span>,labels <span class="op">=</span> <span class="st">"2.5"</span><span class="op">)</span>


<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1.5</span>,y <span class="op">=</span> <span class="fl">3.9</span>,labels <span class="op">=</span> <span class="st">"5.5"</span><span class="op">)</span></code></pre></div>
<p><img src="lll-UPGMA_by_hand-updated_files/figure-html/unnamed-chunk-81-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
