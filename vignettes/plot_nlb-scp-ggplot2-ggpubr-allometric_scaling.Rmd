---
title: "Software checkpoint: ggplot2 and ggpubr-COPY?"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Software checkpoint: ggplot2 and ggpubr-COPY?}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, eval = F}
library(compbio4all)
```



## Vocab

* wrapper
* ggplot2
* ggpubr
* $ operator

## Learning objectives

* Know what a wrapper is
* Know the relationship between ggplot2 and ggpubr
* Be able to run code that makes graphs with ggpubr
* Know how color and shape can make a plot easier to interpret
* Know how to use the $ operator to make new columns


## Introduction

ggplot2 is one of the most well-known and widely used R packages.  It is argueably the most powerful and flexable package for creating plots in R.  

ggplot2 has a very steep learning curve.  ggpubr is a package that creates "wrappers" for much of ggplot2's core functionality.  A **wrapper** is a function that runs another function for you, often making its use easier while also making certain decisions for you by setting certain defaults.

ggpubr is really cool, but unfortunatley its syntax is different from both base R plotting and ggplot2.  I will provide you ggpubr code whenever we need it; feel free to experiment, but you'll need to tinker with it or read the help file.

This Software Check point will have you do the following things to get you set up to use these packages

* Download ggplot2 and ggpubr
* Install a dataset of allometric data similar to the mammals data of MASS
* Make some basic plots

## Preliminaries 

### Download packaged 

Only do this once, then comment out of the script.

```{r}
# install.packages("ggplot2")
# iinstall.packages("ggpubr")
```

### Load the libraries

```{r}
library(ggplot2)
library(ggpubr)
```

### Load the msleep package

The mammals dataset is a classic dataset in the MASS package.  msleep is an updated version of the data that includes more numeric data (e.g. hours of sleep) and categorical data (e.g. if a species is endnagered)


```{r}
data(msleep)
```


## Make a basic ggpubr plot

Let's make a boxplot in ggpubr.  ggpubr has hand functions like ggboxplot, gghistogram, and ggscatter.


### ggpubr syntax

ggpubr does NOT use formula notation like base R function.  You have to explicitly define a y and an x variable.  Additionally, the variables MUST be in quotes.

Let's make a boxplot of the amount of sleep an organism gets (sleep_total) and what it eats (vore).

Note: Ignore any errors; these are due to NAs in the data.

```{r}
ggboxplot(y = "sleep_total",
          x = "vore",
          data = msleep)
```

### Color-coding data

The x-axis is "vore" and is labeled.  A general principle of data visualization is that its always good to vary color, size and shape whenever possible, even if its redudant.  This helps reinforce the groupings or patterns in the data.

Change the color of the lines of the boxes:
```{r}
ggboxplot(y = "sleep_total",
          x = "vore",
          color = "vore",
          data = msleep)
```


Change the fill inside the boxes:
```{r}
ggboxplot(y = "sleep_total",
          x = "vore",
          fill = "vore",
          data = msleep)
```



## Scatter plots in ggpubr

Ignore any errors.

```{r}
ggscatter(y = "sleep_rem",
          x = "sleep_total",
          data = msleep)
```


## Adding a line of best fit

Ignore any errors.

```{r}
ggscatter(y = "sleep_rem",
          x = "sleep_total",
          add = "reg.line",  # line of best fit
          data = msleep)
```


## Adding a data ellipse 

```{r}
ggscatter(y = "sleep_rem",
          x = "sleep_total",
          ellipse = TRUE,   # data ellipse
          data = msleep)
```

## Add a correlation coefficient 

By adding "cor.coef = TRUE' correlation coefficient, as well as a p-value for the significance of the correlation coefficient (testing the hypothesis that it is 0).

```{r}
ggscatter(y = "sleep_rem",
          x = "sleep_total",
          cor.coef = TRUE,
          data = msleep)
```





### Allometry

NOTE: A question about the basic biological issues related to allometry could appear on the next test.

The mammal and msleep data are often used to display the concept of **allometric relationships.**  "Allometry, in its broadest sense, describes how the characteristics of living creatures change with size"  (Shingletone 2010).  Ecologists and evolutinary biologists are often interested how different morphological, physiological, ecological, and life histroy factors vary with size.  For example, larger organism typically have smaller brains, few offspring, and life longer, and these relationships are often linear when plotted on a log-log scale.

Allometry is not an inherently computational discipline, though it can involve a lot of math.  One area of interest to ecologists is how thing like metabolic rate and energy consumption vary as organisms increase in size.  

Allometry research is often used to inform computational research, especially simulation models.  For example, allometric models can be used to predict the size and growth patterns of trees in models that simulate the growth of forests.

### Allometry and log scales
 
Taking the natural log of data is often used to re-scale it or make relationships linear.  Allometric data is often plotted on a log-log scale: both the x and the y variables are logged.

To do this, we'll make new columns.  Let's take the log of brain weight (brainwt) and body weight (bodywt)

First, brain weight.  We can make a new column using the $ operator.  This operator can be used to select a single colunmn, like this

```{r}
mean(msleep$brainwt, na.rm = T)
```

It can also be used to *create* a new variable in a dataframe; here, I make a new column "brainwt_log" that does not yet exist in the msleep dataframe.
```{r}
msleep$brainwt_log <- log(msleep$brainwt)
```

The same thing for bodywt
```{r}
msleep$bodywt_log <- log(msleep$bodywt)
```


## Make an allometric plot

ggpubr does NOT use formula notation like base R function.  You have to explicitly define a y and an x variable.  Additionally, the variables MUST be in quotes.

Note: Ignore any errors; these are due to NAs in the data.

```{r}
ggscatter(y = "brainwt_log",
          x = "bodywt_log",
          data = msleep)
```

## Change color by a categorical variable

```{r}
ggscatter(y = "brainwt_log",
          x = "bodywt_log",
          color = "vore",    # color = 
          data = msleep)
```




```{r}
ggscatter(y = "brainwt_log",
          x = "bodywt_log",
          color = "sleep_total",
          data = msleep)
```




```{r}
ggscatter(y = "brainwt_log",
          x = "bodywt_log",
          shape = "vore",
          data = msleep)
```




```{r}
ggscatter(y = "brainwt_log",
          x = "bodywt_log",
          shape = "vore",
          data = msleep)
```



```{r}
ggscatter(y = "brainwt_log",
          x = "bodywt_log",
          shape = "vore",
          data = msleep,
          facet.by = "vore")
```


