---
title: "Coding checkpoint: Plotting allometric data with ggpubr"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Coding checkpoint: Plotting allometric data with ggpubr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, eval = T}
library(compbio4all)
```




## Vocab

* wrapper
* ggplot2
* ggpubr
* $ operator
* smoother
* continous data
* categorical data

## Learning objectives

* Know what a wrapper is
* Know the relationship between ggplot2 and ggpubr
* Be able to run code that makes graphs with ggpubr
* Know how color and shape can make a plot easier to interpret
* Know how to use the $ operator to make new columns


## Introduction


This Software Check point will have you practice using ggpubr.

## Preliminaries 

### Download packages

Only do this once, then comment out of the script.  You probably already did this in the previous Code Checkpoint.

```{r}
# install.packages("ggplot2")
# iinstall.packages("ggpubr")
```

### Load the libraries

```{r}
library(ggplot2)
library(ggpubr)
```

### Load the msleep package

The mammals dataset is a classic dataset in the MASS package.  msleep is an updated version of the data that includes more numeric data (e.g. hours of sleep) and categorical data (e.g. if a species is endangered)


```{r}
data(msleep)
```


## Make a basic ggpubr scatterplot

### ggpubr syntax

ggpubr does NOT use formula notation like base R function.  You have to explicitly define a y and an x variable.  Additionally, the variables MUST be in quotes.


## Scatter plots in ggpubr

Ignore any errors.

```{r}
ggscatter(y = "sleep_rem",
          x = "sleep_total",
          data = msleep)
```


## Adding a line of best fit

Ignore any errors.

```{r}
ggscatter(y = "sleep_rem",
          x = "sleep_total",
          add = "reg.line",  # line of best fit
          data = msleep)
```


## Adding a data ellipse 

```{r}
ggscatter(y = "sleep_rem",
          x = "sleep_total",
          ellipse = TRUE,   # data ellipse
          data = msleep)
```

## Add a correlation coefficient 

By adding "cor.coef = TRUE' correlation coefficient, as well as a p-value for the significance of the correlation coefficient (testing the hypothesis that it is 0).

```{r}
ggscatter(y = "sleep_rem",
          x = "sleep_total",
          cor.coef = TRUE,
          data = msleep)
```



### Allometry

NOTE: A question about the basic biological issues related to allometry could appear on the next test.

The mammal and msleep data are often used to display the concept of **allometric relationships.**  "Allometry, in its broadest sense, describes how the characteristics of living creatures change with size"  (Shingletone 2010).  Ecologists and evolutionary biologists are often interested how different morphological, physiological, ecological, and life history factors vary with size.  For example, larger organism typically have smaller brains, few offspring, and life longer, and these relationships are often linear when plotted on a log-log scale.

Allometry is not an inherently computational discipline, though it can involve a lot of math.  One area of interest to ecologists is how thing like metabolic rate and energy consumption vary as organisms increase in size.  

Allometry research is often used to inform computational research, especially simulation models.  For example, allometric models can be used to predict the size and growth patterns of trees in models that simulate the growth of forests.

### Allometry and log scales
 
Taking the natural log of data is often used to re-scale it or make relationships linear.  Allometric data is often plotted on a log-log scale: both the x and the y variables are logged.

To do this, we'll make new columns.  Let's take the log of brain weight (brainwt) and body weight (bodywt)

First, brain weight.  We can make a new column using the $ operator.  This operator can be used to select a single column, like this

```{r}
mean(msleep$brainwt, na.rm = T)
```

It can also be used to *create* a new variable in a dataframe; here, I make a new column "brainwt_log" that does not yet exist in the msleep dataframe.
```{r}
msleep$brainwt_log <- log(msleep$brainwt)
```

The same thing for bodywt
```{r}
msleep$bodywt_log <- log(msleep$bodywt)
```


## Make an allometric plot

ggpubr does NOT use formula notation like base R function.  You have to explicitly define a y and an x variable.  Additionally, the variables MUST be in quotes.

Note: Ignore any errors; these are due to NAs in the data.

```{r}
ggscatter(y = "brainwt_log",
          x = "bodywt_log",
          data = msleep)
```

## Change color by a categorical variable

```{r}
ggscatter(y = "brainwt_log",
          x = "bodywt_log",
          color = "vore",    # color = 
          data = msleep)
```

## Change color by a continuous variable


```{r}
ggscatter(y = "brainwt_log",
          x = "bodywt_log",
          color = "sleep_total",
          data = msleep)
```


## Add a smoother

A **smoother** is a data exploration tool which helps you visualize trends in the data.  There are many ways to calculate them, but conceptually they work by taking doing something akin to taking a weight average of sets of adjacent points.  A simple type is a **loess** smoother, which can easily be added in ggpubr.

```{r}
ggscatter(y = "brainwt",
          x = "bodywt_log",
          add  = "loess",
          data = msleep)
```


## Task

* Create a new column sleep_total_log
* plot sleep_total_log on the y axis
* plot brainwt_log on the axis
* add a line of best fit
* add a correlation coefficient
* color-code the data by bodywt_log

If you have a problem, make sure that things are in quotes as appropriate, and that there is a comma at the end of each line as needed.  Note that    cor.coef = TRUE doesn't use quotes.



